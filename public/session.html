<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Telegram Session Generator</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: 'Segoe UI', Arial, sans-serif;
      background: linear-gradient(135deg, #0d0d0d 0%, #1a1a2e 50%, #16213e 100%);
      color: #ffffff;
      min-height: 100vh;
      padding: 20px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
    }
    
    .container {
      background: rgba(25, 25, 35, 0.95);
      border-radius: 16px;
      padding: 40px 30px;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
      border: 1px solid rgba(255, 255, 255, 0.1);
      max-width: 480px;
      width: 100%;
      backdrop-filter: blur(10px);
    }
    
    .header {
      text-align: center;
      margin-bottom: 30px;
    }
    
    .header h2 {
      font-size: 28px;
      font-weight: 600;
      background: linear-gradient(45deg, #28a745, #20c997);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      margin-bottom: 8px;
    }
    
    .header p {
      color: #a0a0a0;
      font-size: 14px;
      line-height: 1.4;
    }
    
    .input-group {
      margin-bottom: 20px;
      text-align: left;
    }
    
    .input-group label {
      display: block;
      margin-bottom: 8px;
      color: #e0e0e0;
      font-size: 14px;
      font-weight: 500;
    }
    
    input {
      width: 100%;
      padding: 14px 16px;
      border: 2px solid #333344;
      border-radius: 10px;
      background: #1a1a2e;
      color: #ffffff;
      font-size: 15px;
      transition: all 0.3s ease;
    }
    
    input:focus {
      outline: none;
      border-color: #28a745;
      background: #1e1e3a;
      box-shadow: 0 0 0 3px rgba(40, 167, 69, 0.1);
    }
    
    input::placeholder {
      color: #666677;
    }
    
    .button-group {
      display: flex;
      flex-direction: column;
      gap: 12px;
      margin: 25px 0;
    }
    
    button {
      padding: 14px 20px;
      border: none;
      border-radius: 10px;
      font-size: 15px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    
    .btn-primary {
      background: linear-gradient(45deg, #28a745, #20c997);
      color: white;
    }
    
    .btn-primary:hover {
      background: linear-gradient(45deg, #218838, #1ea085);
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(40, 167, 69, 0.3);
    }
    
    .btn-secondary {
      background: #333344;
      color: #ffffff;
    }
    
    .btn-secondary:hover {
      background: #444455;
      transform: translateY(-2px);
    }
    
    .otp-section {
      background: rgba(40, 167, 69, 0.1);
      border: 1px solid rgba(40, 167, 69, 0.3);
      border-radius: 10px;
      padding: 20px;
      margin: 20px 0;
      display: none;
    }
    
    .otp-section h3 {
      color: #28a745;
      margin-bottom: 15px;
      font-size: 16px;
      text-align: center;
    }
    
    .output-section {
      margin-top: 25px;
    }
    
    .output-section h3 {
      color: #e0e0e0;
      margin-bottom: 12px;
      font-size: 16px;
      text-align: center;
    }
    
    pre {
      background: #1a1a2e;
      border: 1px solid #333344;
      border-radius: 10px;
      padding: 16px;
      color: #28a745;
      font-size: 13px;
      line-height: 1.4;
      max-height: 200px;
      overflow-y: auto;
      white-space: pre-wrap;
      word-break: break-all;
      text-align: left;
    }
    
    .status-message {
      padding: 12px 16px;
      border-radius: 8px;
      margin: 15px 0;
      text-align: center;
      font-size: 14px;
      display: none;
    }
    
    .status-success {
      background: rgba(40, 167, 69, 0.2);
      border: 1px solid rgba(40, 167, 69, 0.5);
      color: #28a745;
    }
    
    .status-error {
      background: rgba(220, 53, 69, 0.2);
      border: 1px solid rgba(220, 53, 69, 0.5);
      color: #dc3545;
    }
    
    .info-box {
      background: rgba(255, 193, 7, 0.1);
      border: 1px solid rgba(255, 193, 7, 0.3);
      border-radius: 8px;
      padding: 15px;
      margin: 20px 0;
      font-size: 13px;
      color: #ffc107;
    }
    
    .info-box ul {
      list-style: none;
      padding-left: 0;
    }
    
    .info-box li {
      margin: 8px 0;
      padding-left: 20px;
      position: relative;
    }
    
    .info-box li:before {
      content: "‚Ä¢";
      color: #ffc107;
      position: absolute;
      left: 8px;
    }
    
    @media (max-width: 480px) {
      .container {
        padding: 30px 20px;
        margin: 10px;
      }
      
      .header h2 {
        font-size: 24px;
      }
      
      input, button {
        padding: 12px 14px;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h2>‚öôÔ∏è Telegram Session Generator</h2>
      <p>Generate session strings for your Telegram applications</p>
    </div>

    <div class="info-box">
      <ul>
        <li>Get API ID & Hash from <a href="https://my.telegram.org/auth" style="color: #28a745; text-decoration: none;" target="_blank">my.telegram.org</a></li>
        <li>Enter your phone number with country code (e.g., +1234567890)</li>
        <li>You'll receive an OTP via Telegram</li>
      </ul>
    </div>

    <div class="input-group">
      <label for="apiId">API ID</label>
      <input type="text" id="apiId" placeholder="Enter your API ID" />
    </div>

    <div class="input-group">
      <label for="apiHash">API Hash</label>
      <input type="text" id="apiHash" placeholder="Enter your API Hash" />
    </div>

    <div class="input-group">
      <label for="phone">Phone Number</label>
      <input type="text" id="phone" placeholder="+CountryCode Number (e.g., +1234567890)" />
    </div>

    <div class="button-group">
      <button class="btn-primary" onclick="sendCode()">Send OTP Code</button>
    </div>

    <div id="statusMessage" class="status-message"></div>

    <div id="otpSection" class="otp-section">
      <h3>üì± Enter Verification Code</h3>
      <div class="input-group">
        <label for="otp">OTP Code</label>
        <input type="text" id="otp" placeholder="Enter the code sent to your Telegram" />
      </div>
      <div class="button-group">
        <button class="btn-primary" onclick="verifyOtp()">Generate Session</button>
        <button class="btn-secondary" onclick="resetForm()">Cancel</button>
      </div>
    </div>

    <div class="output-section">
      <h3>Session String</h3>
      <pre id="output">Your session will appear here after successful verification...</pre>
    </div>
  </div>

  <script>
    let phoneCodeHash = null;

    function showStatus(message, type = 'success') {
      const statusEl = document.getElementById('statusMessage');
      statusEl.textContent = message;
      statusEl.className = `status-message status-${type}`;
      statusEl.style.display = 'block';
      
      setTimeout(() => {
        statusEl.style.display = 'none';
      }, 5000);
    }

    async function sendCode() {
      const apiId = document.getElementById('apiId').value.trim();
      const apiHash = document.getElementById('apiHash').value.trim();
      const phone = document.getElementById('phone').value.trim();

      if (!apiId || !apiHash || !phone) {
        showStatus('Please fill in all fields!', 'error');
        return;
      }

      if (!phone.startsWith('+')) {
        showStatus('Phone number must start with country code (e.g., +1)', 'error');
        return;
      }

      showStatus('Sending OTP code...', 'success');

      try {
        const res = await fetch('/api/sessiongen', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ step: 'send_code', apiId, apiHash, phone })
        });
        
        const data = await res.json();
        
        if (data.success) {
          showStatus('OTP sent successfully to your Telegram!', 'success');
          phoneCodeHash = data.phone_code_hash;
          document.getElementById('otpSection').style.display = 'block';
          document.getElementById('output').textContent = 'Waiting for OTP verification...';
        } else {
          showStatus(data.message || 'Failed to send OTP', 'error');
        }
      } catch (error) {
        showStatus('Network error. Please try again.', 'error');
        console.error('Error:', error);
      }
    }

    async function verifyOtp() {
      const apiId = document.getElementById('apiId').value.trim();
      const apiHash = document.getElementById('apiHash').value.trim();
      const phone = document.getElementById('phone').value.trim();
      const otp = document.getElementById('otp').value.trim();
      
      if (!otp) {
        showStatus('Please enter the OTP code!', 'error');
        return;
      }

      if (!phoneCodeHash) {
        showStatus('Please request a new OTP code first!', 'error');
        return;
      }

      showStatus('Verifying OTP and generating session...', 'success');

      try {
        const res = await fetch('/api/sessiongen', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ 
            step: 'verify_otp', 
            apiId, 
            apiHash, 
            phone, 
            otp,
            phoneCodeHash 
          })
        });

        const data = await res.json();
        
        if (data.success) {
          showStatus('Session generated successfully!', 'success');
          document.getElementById('output').textContent = data.session_string;
          
          // Auto-download session file
          const blob = new Blob([data.session_string], { type: 'text/plain' });
          const link = document.createElement('a');
          link.href = URL.createObjectURL(blob);
          link.download = 'telegram_session.txt';
          link.click();
          
          document.getElementById('otpSection').style.display = 'none';
        } else {
          showStatus(data.message || 'Failed to verify OTP', 'error');
        }
      } catch (error) {
        showStatus('Network error. Please try again.', 'error');
        console.error('Error:', error);
      }
    }

    function resetForm() {
      document.getElementById('otpSection').style.display = 'none';
      document.getElementById('otp').value = '';
      phoneCodeHash = null;
      document.getElementById('output').textContent = 'Your session will appear here after successful verification...';
    }

    // Enter key support
    document.addEventListener('keypress', function(event) {
      if (event.key === 'Enter') {
        if (document.getElementById('otpSection').style.display === 'block') {
          verifyOtp();
        } else {
          sendCode();
        }
      }
    });
  </script>
</body>
</html>
